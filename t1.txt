async function getNextDocumentId(userId: string): Promise<number> {
  const counterRef = doc(db, 'userCounters', userId);
  
  const newCount = await runTransaction(db, async (transaction) => {
    const counterDoc = await transaction.get(counterRef);
    const currentCount = counterDoc.exists() ? counterDoc.data().count : 0;
    const nextCount = currentCount + 1;
    
    transaction.set(counterRef, { count: nextCount }, { merge: true });
    
    return nextCount;
  });
  
  return newCount;
}